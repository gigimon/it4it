Настройка NFS сервера и клиента
###############################
:date: 2008-09-14 14:45
:author: gigimon
:category: \*nix
:tags: linux, mount, nfs
:slug: nastrojka-nfs-servera-i-klienta

Имеется у меня дома два компьютера и один сервер-шлюз-качалка. Причем 1
компьютер находится в другой комнате и соединен с ними по Wi-Fi. Общим
местом для обмена информацией между компьютерами долгое время был фтп,
но как-то раз решил я использовать нормальную сетевую ФС. Выбор пал на
NFS, т.к. ее и Windows умеет примаунчивать. В этой заметке, хочу
рассказать про свой опыт настройки на основе Gentoo Linux на сервере и
клиенте.

1. Общие настройки для сервера и клиента

Для начала, надо убедиться что поддержка NFS включена в ядро, как модуль
или вкомпилено в ядро.

Я вкомпилил в ядро:

|image0|

Если у вас собрано как модуль ядра, то в lsmod должы быть подгружены:
nfs и nfsd, если их нет, то подгрузите, командой: modprobe nfs &&
modprobe nfsd.

После этого, надо установить пакет nfs-utils на сервере и на клиенте, а
также проверить, что установлен пакет portmap.

2. Настройка сервера

Настройка сервера заключается в редактировании файла /etc/exports, для
указания расшареных папок, а также прав на них для разных компьютеров
сети. Формат этого файла такой:

.. code-block:: bash

    directory machineA(option,option) machineB(option,option) ...

Где:

directory - папка, которую надо расшарить.

machineA, machineB - адрес клиента, которому разрешен доступ к папке.

option - опции для этого клиента.

Адрес клиента можно задавать указаием IP-адреса, указанием его имени, а
также указанием подсети.

В моем случае, я расшаривал домашнюю папку на сервере /home/aliens,

.. code-block:: bash

    /home/aliens 192.168.66.0/24(async,no_subtree_check,rw)

После этого, можно запускать NFS сервер:

.. code-block:: bash

    /etc/init.d/nfs start

Если появится ошибка: Cannot register service: RPC: Unable to receive;
errno=Connection refused, то проверьте, что у вас запущен portmap (
/etc/init.d/portmap start )

Если запустился удачно, то стоит добавить в автозагрузку

.. code-block:: bash

    rc-update add nfs default

    rc-update add portmap default

3. Настройка клиента

Чтобы примаунтить удаленную папку, можно использовать команду mount в
виде:

.. code-block:: bash

    mount адрес_сервера:/путь_до_папки точка_монтирования

В моем случае:

.. code-block:: bash

    mount 192.168.66.250:/home/aliens /media/server

Если portmap запущен и установлены nfs-utils, то команда mount сработает
и в точке монтирования найдете удаленное содержимое.

Чтобы папка NFS монтировалась автоматчиески при запуске системы, следует
в /etc/fstab добавить слеюущую строку:

.. code-block:: bash

    x.x.x.x:/directory  /mount_directory    nfs          rw            0    0

А также, добавить в автозапуск сервис nfsmount

.. code-block:: bash

    rc-update add nfsmount default

Для более подробного разбора опций прав, можно прочитать `тут`_

Либо в официальном мане.

Надеюсь кому-то эта статья поможет. Удачи ;)

.. _тут: http://gentoo-wiki.com/HOWTO_Share_Directories_via_NFS

.. |image0| image:: {filename}/images/2008/09/kernelnfs-450x155.png
   :target: {filename}/images/2008/09/kernelnfs.png
